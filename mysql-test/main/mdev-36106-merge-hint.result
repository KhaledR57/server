create table t1 select seq as i, 10*seq as j from seq_1_to_10;
set @save_optimizer_trace=@@optimizer_trace;
set @save_optimizer_switch=@@optimizer_switch;
set optimizer_trace='enabled=on';
set session optimizer_switch='derived_merge=on';
SELECT a, b FROM (SELECT i as a, j as b FROM t1) AS dt WHERE a < 3 AND b > 8;
a	b
1	10
2	20
select json_extract(trace, '$.steps[0].join_preparation.steps[0].derived.algorithm') from information_schema.optimizer_trace;
json_extract(trace, '$.steps[0].join_preparation.steps[0].derived.algorithm')
"merged"
SELECT /*+ NO_MERGE(dt) */ a, b FROM (SELECT i as a, j as b FROM t1) AS dt WHERE a < 3 AND b > 8;
a	b
1	10
2	20
Warnings:
Warning	4209	Unresolved table name `dt`@`select#1` for NO_MERGE hint
select json_extract(trace, '$.steps[0].join_preparation.steps[0].derived.algorithm') from information_schema.optimizer_trace;
json_extract(trace, '$.steps[0].join_preparation.steps[0].derived.algorithm')
"materialized"
set session optimizer_switch='derived_merge=off';
SELECT a, b FROM (SELECT i as a, j as b FROM t1) AS dt WHERE a < 3 AND b > 8;
a	b
1	10
2	20
select json_extract(trace, '$.steps[0].join_preparation.steps[0].derived.algorithm') from information_schema.optimizer_trace;
json_extract(trace, '$.steps[0].join_preparation.steps[0].derived.algorithm')
"materialized"
SELECT /*+ MERGE(dt) */ a, b FROM (SELECT i as a, j as b FROM t1) AS dt WHERE a < 3 AND b > 8;
a	b
1	10
2	20
Warnings:
Warning	4209	Unresolved table name `dt`@`select#1` for MERGE hint
select json_extract(trace, '$.steps[0].join_preparation.steps[0].derived.algorithm') from information_schema.optimizer_trace;
json_extract(trace, '$.steps[0].join_preparation.steps[0].derived.algorithm')
"merged"
set optimizer_switch=@save_optimizer_switch;
set optimizer_trace=@save_optimizer_trace;
drop table t1;
