set time_zone='+00:00';
#
# MDEV-29750 triggers can modify history
#
set sql_mode='', timestamp=unix_timestamp('2010-10-10 10:10:10');
create table t (a int, b int as (a+1), s timestamp(6) as row start, e timestamp(6) as row end, period for system_time(s,e)) with system versioning;
insert into t values (1,1, '2022-01-01','2023-01-01'),(2,2, '2022-02-02','2023-02-02');
Warnings:
Warning	1906	The value specified for generated column 'b' in table 't' has been ignored
Warning	1906	The value specified for generated column 's' in table 't' has been ignored
Warning	1906	The value specified for generated column 'e' in table 't' has been ignored
Warning	1906	The value specified for generated column 'b' in table 't' has been ignored
Warning	1906	The value specified for generated column 's' in table 't' has been ignored
Warning	1906	The value specified for generated column 'e' in table 't' has been ignored
create trigger tr before insert on t for each row set new.b=1, new.s = '2022-03-03', new.e = '2023-03-03';
insert into t (a) values (3),(4);
select * from t for system_time all;
a	b	s	e
1	2	2010-10-10 10:10:10.000000	2038-01-19 03:14:07.999999
2	3	2010-10-10 10:10:10.000000	2038-01-19 03:14:07.999999
3	4	2010-10-10 10:10:10.000000	2038-01-19 03:14:07.999999
4	5	2010-10-10 10:10:10.000000	2038-01-19 03:14:07.999999
drop table t;
set sql_mode=default, timestamp=default;
#
# End of 10.3 tests
#
# Don't allow changes from the past
create or replace table t1 (pk int primary key, i int) with system versioning;
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `pk` int(11) NOT NULL,
  `i` int(11) DEFAULT NULL,
  PRIMARY KEY (`pk`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci WITH SYSTEM VERSIONING
set timestamp=12345;
insert t1(pk, i) values(1,3);
set timestamp=12344;
delete from t1;
select pk,i from t1 for system_time all;
pk	i
set timestamp=12345;
insert t1(pk, i) values(1,3);
set timestamp=12344;
replace t1(pk, i) values(1,4);
select pk,i from t1 for system_time all;
pk	i
1	4
drop table t1;
#
# End of 10.5 tests
#
