drop table if exists t1;
#
# MDEV-32884 Make s3_debug dynamic
#
create or replace table t1 (a int, b int, c varchar(1000), key (a), key(c)) engine=aria;
Warnings:
Note	1071	Specified key was too long; max key length is 2300 bytes
insert into t1 select seq, seq+10, repeat(char(65+ mod(seq, 20)),mod(seq,1000)) from seq_1_to_100;
alter table t1 engine=s3;
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL,
  `c` varchar(1000) DEFAULT NULL,
  KEY `a` (`a`),
  KEY `c` (`c`(575))
) ENGINE=S3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci PAGE_CHECKSUM=1
select count(*) from t1;
count(*)
100
flush table t1;
NOT FOUND /s3_test_/ in mysqld.1.err
set @@global.s3_debug=1;
select count(*) from t1;
count(*)
100
set @@global.s3_debug=0;
FOUND 6 /s3_test_/ in mysqld.1.err
select count(*) from t1;
count(*)
100
drop table t1;
FOUND 6 /s3_test_/ in mysqld.1.err
SET @saved_dbug = @@debug_dbug;
CREATE TABLE p0 (
c1 int primary key,
c2 int DEFAULT NULL
) ENGINE=InnoDB;
insert into p0 select seq,seq from seq_1_to_10;
SET debug_dbug='+d,failed_create_partitioning_metadata';
alter table p0 engine=s3
PARTITION BY RANGE (c1)
(PARTITION p0 VALUES LESS THAN (100));
ERROR HY000: Simulated crash
SET debug_dbug=@saved_dbug;
drop table p0;
drop table p0;
ERROR 42S02: Unknown table 's3.p0'
create table t1 (a int);
create table t2 (b int);
alter table t1 engine=s3;
set @debug_crash_counter= 1;
set @@debug_dbug= '+d,ddl_log_create_before_install_new';
# No crash means atomic C-O-R is not used
create or replace table t1 (b int);
alter table t1 engine=s3;
create or replace table t1 like t2;
alter table t1 engine=s3;
create or replace table t1 select * from t2;
set @@debug_dbug= @saved_dbug;
drop tables t1, t2;
